syntax = "proto3";

package services;

import "models/user.proto";
import "common/types.proto";

option java_multiple_files = true;
option java_package = "com.example.services";

// User management service with CRUD operations
service UserService {
  // Unary - Create a new user
  rpc CreateUser (CreateUserRequest) returns (models.User);
  
  // Unary - Get a single user by ID
  rpc GetUser (GetUserRequest) returns (models.User);
  
  // Server streaming - List users with pagination
  rpc ListUsers (ListUsersRequest) returns (stream models.User);
  
  // Unary - Update a user
  rpc UpdateUser (UpdateUserRequest) returns (models.User);
  
  // Unary - Delete a user
  rpc DeleteUser (DeleteUserRequest) returns (DeleteResponse);
  
  // Unary - Batch get users
  rpc BatchGetUsers (BatchGetUsersRequest) returns (BatchGetUsersResponse);
  
  // Server streaming - Search users
  rpc SearchUsers (SearchUsersRequest) returns (stream models.User);
}

message CreateUserRequest {
  string name = 1;
  string email = 2;
  int32 age = 3;
  common.Address address = 4;
  repeated string roles = 5;
}

message GetUserRequest {
  string id = 1;
}

message ListUsersRequest {
  int32 page = 1;
  int32 page_size = 2;
  models.UserStatus status = 3; // Filter by status
}

message UpdateUserRequest {
  string id = 1;
  string name = 2;
  string email = 3;
  int32 age = 4;
  models.UserStatus status = 5;
  common.Address address = 6;
}

message DeleteUserRequest {
  string id = 1;
}

message DeleteResponse {
  bool success = 1;
  string message = 2;
}

message BatchGetUsersRequest {
  repeated string ids = 1;
}

message BatchGetUsersResponse {
  repeated models.User users = 1;
  repeated string not_found_ids = 2;
}

message SearchUsersRequest {
  string query = 1;
  int32 limit = 2;
}
