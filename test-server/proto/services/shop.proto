syntax = "proto3";

package services;

import "models/product.proto";
import "models/order.proto";
import "common/types.proto";

option java_multiple_files = true;
option java_package = "com.example.services";

// E-commerce service with various patterns
service ShopService {
  // Unary - Create a product
  rpc CreateProduct (CreateProductRequest) returns (models.Product);
  
  // Unary - Get product
  rpc GetProduct (GetProductRequest) returns (models.Product);
  
  // Server streaming - List products
  rpc ListProducts (ListProductsRequest) returns (stream models.Product);
  
  // Unary - Create order
  rpc CreateOrder (CreateOrderRequest) returns (models.Order);
  
  // Unary - Get order
  rpc GetOrder (GetOrderRequest) returns (models.Order);
  
  // Server streaming - Track order status changes
  rpc TrackOrder (TrackOrderRequest) returns (stream OrderStatusUpdate);
  
  // Client streaming - Batch create products
  rpc BatchCreateProducts (stream CreateProductRequest) returns (BatchCreateResponse);
}

message CreateProductRequest {
  string name = 1;
  string description = 2;
  double price = 3;
  string currency = 4;
  int32 stock_quantity = 5;
  string category = 6;
  repeated string tags = 7;
}

message GetProductRequest {
  string id = 1;
}

message ListProductsRequest {
  int32 page = 1;
  int32 page_size = 2;
  string category = 3;
  double min_price = 4;
  double max_price = 5;
}

message CreateOrderRequest {
  string user_id = 1;
  repeated OrderItemRequest items = 2;
  common.Address shipping_address = 3;
}

message OrderItemRequest {
  string product_id = 1;
  int32 quantity = 2;
}

message GetOrderRequest {
  string id = 1;
}

message TrackOrderRequest {
  string order_id = 1;
}

message OrderStatusUpdate {
  string order_id = 1;
  models.OrderStatus status = 2;
  string message = 3;
  string timestamp = 4;
}

message BatchCreateResponse {
  int32 total_created = 1;
  repeated string product_ids = 2;
  repeated string errors = 3;
}
